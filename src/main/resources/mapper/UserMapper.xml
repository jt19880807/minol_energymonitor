<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.minol.energymonitor.repository.UserMapper" >
    <resultMap id="UserResult" type="com.minol.energymonitor.domain.entity.SysUser">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="role_id" property="role_id"/>
        <result column="status" property="status"/>
        <result column="createtime" property="createtime"/>
        <result column="last_login" property="last_login"/>
        <result column="rolename" property="rolename"/>
        <result column="projects" property="projects"/>
        <!--<association property="sysRole" column="role_id" select="com.minol.energymonitor.repository.RoleMapper.selectRoleById"/>-->
    </resultMap>
    <!--表名 -->
    <sql id="tableName">
        sys_user
    </sql>
    <sql id="roleTableName">
        sys_role
    </sql>

    <sql id="field">
        username,
        password,
        role_id,
        projects,
        status,
        createtime,
        last_login
    </sql>

    <sql id="fieldValue">
        #{username},
        #{password},
        #{role_id},
        #{projects},
        #{status},
        #{createtime},
        #{last_login}
    </sql>

    <!--查询所有的用户信息和角色信息-->
    <select id="selectAllUsers" resultMap="UserResult">
        SELECT u.*,r.name as rolename FROM <include refid="tableName"></include> u
        left JOIN <include refid="roleTableName"></include> r  on u.role_id=r.id
        WHERE r.status!=1 and u.status!=1
    </select>

    <select id="selectUserByName"  resultType="com.minol.energymonitor.domain.entity.SysUser">
         SELECT * FROM <include refid="tableName"></include> WHERE username = #{name} AND status!=1
    </select>

    <!--根据主键ID查询项目信息-->
    <select id="selectUserById"  parameterType="int" resultType="com.minol.energymonitor.domain.entity.SysUser">
        SELECT * FROM <include refid="tableName"></include> WHERE id = #{id} AND status!=1
    </select>

    <!--批量删除-->
    <update id="batchDeleteUsers" parameterType="java.util.List">
        UPDATE <include refid="tableName"></include>
          SET status=1
          WHERE id in
            <foreach item="item" index="index" collection="list" open="(" separator="," close=")">
                #{item.id}
            </foreach>
        AND id!=1
    </update>

    <!--新增用户-->
    <insert id="insertUser" parameterType="com.minol.energymonitor.domain.entity.SysUser">
        INSERT <include refid="tableName"></include> (
        <include refid="field"></include>
        ) VALUES (
        <include refid="fieldValue"></include>
        )
    </insert>

    <!--修改用户-->
    <update id="updateUser" parameterType="com.minol.energymonitor.domain.entity.SysUser">
        UPDATE <include refid="tableName"></include>
        SET username=#{username},
        role_id=#{role_id},
        projects=#{projects},
        status=#{status}
        WHERE id=#{id}
    </update>
    <!--修改指定用户的密码-->
    <update id="updatePwd" parameterType="com.minol.energymonitor.domain.entity.SysUser">
        UPDATE <include refid="tableName"></include>
        SET password=#{password}
        WHERE id=#{id}
    </update>

</mapper>