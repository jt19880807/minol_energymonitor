<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.minol.energymonitor.repository.UserMapper" >
    <resultMap id="UserResult" type="com.minol.energymonitor.domain.entity.SysUser">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="role_id" property="role_id"/>
        <result column="status" property="status"/>
        <result column="createtime" property="createtime"/>
        <result column="last_login" property="last_login"/>
        <result column="rolename" property="rolename"/>
        <!--<association property="sysRole" column="role_id" select="com.minol.energymonitor.repository.RoleMapper.selectRoleById"/>-->
    </resultMap>
    <!--表名 -->
    <sql id="tableName">
        sys_user
    </sql>
    <sql id="roleTableName">
        sys_role
    </sql>

    <!--查询所有的用户信息和角色信息-->
    <select id="selectAllUsers" resultMap="UserResult">
        SELECT u.*,r.name as rolename FROM <include refid="tableName"></include> u
        left JOIN <include refid="roleTableName"></include> r  on u.role_id=r.id
        WHERE status!=1
    </select>
    <!--<select id="selectRole" parameterType="int" resultType="com.minol.energymonitor.domain.entity.SysRole">-->
        <!--SELECT * from sys_role where id=#{id}-->
    <!--</select>-->
    <select id="selectUserByName"  resultType="com.minol.energymonitor.domain.entity.SysUser">
         SELECT * FROM <include refid="tableName"></include> WHERE username = #{name}
    </select>

    <!--批量删除-->
    <update id="batchDeleteUsers" parameterType="java.util.List">
        UPDATE <include refid="tableName"></include>
          SET status=1
          WHERE id in
            <foreach item="item" index="index" collection="list" open="(" separator="," close=")">
                #{item.id}
            </foreach>
        AND id!=1
    </update>

</mapper>